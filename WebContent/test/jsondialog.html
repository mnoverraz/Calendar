<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JSON dialog test</title>
<script type='text/javascript' src='../misc/js/jquery/jquery-1.7.1.min.js'></script>
<script type='text/javascript' src='../misc/js/jquery/jquery.ui.core.js'></script>
<script type='text/javascript' src='../misc/js/jquery/jquery.plugin.js'></script>
<link rel="stylesheet" type="text/css" href="../misc/css/jquery-ui-1.8.4.custom.css" media="screen" />
<script type='text/javascript'>
	$(document).ready(function() {
		$('#timeSlotException').click(function() {
			res = getMessage("timeSlotException");
			message = exceptionToUI("TimeSlotException", res["content"][0]["TimeSlotException"]);
			showDialog(message);
			log(var_dump(null, res));
		});
		$('#formNotValidException').click(function() {
			res = getMessage("formNotValidException");
			showDialog(res);
			log(var_dump(null, res));
		});
		$('#eventAdded').click(function() {
			res = getMessage("eventAdded");
			showDialog(res);
			log(var_dump(null, res));
		});
	});

	function showDialog(message) {
		$("#test-dialog").html(message);
		buttonsOpts = {}
	    buttonsOpts["Fermer"] = function() {
	        $(this).dialog( "close" );
	    };
	    $("#test-dialog").dialog({
	        resizable: false,
	        width: 350,
	        modal: true,
	        buttons: buttonsOpts
	    });
	}
	
	function exceptionToUI(exceptionType, detail) {
		out = "";
		switch(exceptionType) {
        	case 'TimeSlotException' :
				out += "<ul>";
				$.each(detail, function(k, v) {
					out += "<li>";
					out += v["start"] + " " + v["end"];
					out += "</li>";
				});
				out += "</ul>";
				break;
        	default :
        		out += "Other exception";
        		break;
		}
		return out;
	}
	
	function var_dump(key, value) {
		res = "<ul>";
		if (value != null) {
			res += "<li>";
			if (key != null) 
				res += key + ": ";
			if (value instanceof Object) {
				$.each(value, function(k, v) {
					res += "<ul>";
					res += var_dump(k, v);
					res += "</ul>";
				});
			}
			else {
				res += value;
			}
			res += "</li>"
		}
		res += "</ul>";
		return res;
	}
	
	function log(res) {
		$('#log').append("<br/>result" + var_dump(null, res));
		$('#log').append("<br/>--------------");
	}
	function getMessage(messageType) {
		timeSlotException = {
			    "success": false,
			    "content": [
			        {
			            "TimeSlotException": [
			                {
			                    "start": "2012-06-02 21:50",
			                    "end": "2012-06-02 23:50"
			                },
			                {
			                    "start": "2012-06-05 21:50",
			                    "end": "2012-06-05 23:50"
			                },
			                {
			                    "start": "2012-06-07 21:50",
			                    "end": "2012-06-07 23:50"
			                }
			            ]
			        }
			    ]
			};
		formNotValidException ={
			    "success": false,
			    "content": [
			        {
			            "FormNotValidException": {
			                "title": false,
			                "startH": false,
			                "repeatMode": false,
			                "allDay": true,
			                "endH": false,
			                "endM": false,
			                "date": false,
			                "startM": false
			            }
			        }
			    ]
			};
		eventAdded = {
			    "success": true,
			    "content": [
			        {
			            "id": "1",
			            "title": "event 1 (récurrent)",
			            "allDay": false,
			            "start": "2012-06-15 08:00",
			            "end": "2012-06-15 10:00"
			        },
			        {
			            "id": "1",
			            "title": "event 1 (récurrent)",
			            "allDay": true,
			            "start": "2012-06-02 22:13",
			            "end": "2012-06-02 22:13"
			        },
			        {
			            "id": "2",
			            "title": "event 2",
			            "allDay": false,
			            "start": "2012-06-16 11:00",
			            "end": "2012-06-16 13:00"
			        },
			        {
			            "id": "3",
			            "title": "event 3",
			            "allDay": false,
			            "start": "2012-06-05 22:00",
			            "end": "2012-06-05 23:00"
			        },
			        {
			            "id": "3",
			            "title": "event 3",
			            "allDay": false,
			            "start": "2012-06-07 22:30",
			            "end": "2012-06-07 23:45"
			        }
			    ]
			};

		if ("timeSlotException" == messageType)
			return timeSlotException;
		else if ("eventAdded" == messageType)
			return eventAdded;
		else if ("formNotValidException")
			return formNotValidException

	}
</script>
</head>
<body>
<div id="test-dialog" title="TestDialog"></div>
	<a href="#" id="formNotValidException">Get FormNotValidException</a>
	<br />
	<br />
	<a href="#" id="timeSlotException">Get TimeSlotException</a>
	<br />
	<br />
	<a href="#" id="eventAdded">Get EventAdded</a>
	<br />
	<br />
	Log: <br/>
	<pre id="log"></pre>
</body>
</html>